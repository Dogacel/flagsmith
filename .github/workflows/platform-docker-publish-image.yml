name: Platform Publish Docker Images

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
#  push:
#    tags:
#      - '*'

jobs:
  build-dockerhub:
    runs-on: ubuntu-latest
    name: Platform Publish Docker Image

    permissions:
      id-token: write
      contents: read

    steps:
      - name: Cloning repo
        uses: actions/checkout@v3

      - name: Update flagsmith-charts values.yaml with latest docker version
        uses: fjogeleit/yaml-update-action@main
        with:
          token: ${{ secrets.FLAGSMITH_CHARTS_GITHUB_TOKEN }}
          repository: flagsmith/flagsmith-charts
          workDir: chart
          masterBranchName: 'main'
          targetBranch: 'main'
          branch: docker-image-version-bump-2.89.0
          commitChange: true
          createPR: true
          message: 'Flagsmith docker image version bump'
          description: 'Automated PR generated by a release event in https://github.com/Flagsmith/flagsmith'
          valueFile: 'charts/flagsmith/Chart.yaml'
          value: 2.89.0
          propertyPath: 'appVersion'
