FROM ghcr.io/flagsmith/e2e-frontend-base:latest

# Build Flagsmith
WORKDIR /srv/flagsmith
COPY package.json package-lock.json .npmrc .nvmrc ./
COPY bin/ ./bin/
COPY env/ ./env/

# Run npm ci before copying source code to improve caching of layers. Cache clean no needed?
# RUN npm cache clean --force
ENV ENV=e2e
RUN npm ci


COPY . .
# Commented because it is already executed on the postinstall hook of npm ci
# RUN npm run env

CMD ["bash", "-l"]